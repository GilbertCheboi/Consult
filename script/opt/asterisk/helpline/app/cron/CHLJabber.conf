[CHLJabber]
exten => s,1,Answer()
 same => n,Set(CHLDATA=)
 same => n,Set(CHATHOST=localhost)
 same => n,Set(CHATUSER=root)
 same => n,Set(CHATPASS=root)
 same => n,Set(CHATNAME=CHL)
 same => n,Set(NUMCHAR=0123456789)
 same => n,Set(CHLINTERNAL=Off)
 same => n,Set(SESSKEY=${UNIQUEID})
 same => n,Set(CHLREPLIES=)
 same => n,Set(ALPHACHAR=abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ)
 same => n,Set(CHATCHAR=${ALPHACHAR}${NUMCHAR}\,\ )
 same => n,MYSQL(Connect CONNID ${CHATHOST} ${CHATUSER} ${CHATPASS} ${CHATNAME})
;********************************************************************************
 same => n(jabberdata),NoOp()
 same => n,Set(CHLCHAT=${MESSAGE(body)})
 same => n,Set(TOFULL=${MESSAGE(to)})
 same => n,Set(TOFULL=${CUT(TOFULL,:,2)}) ; to cut off xmpp:
 same => n,Set(CHLACCOUNT=${CUT(TOFULL,/,1)}) ; to cut off /resource
 same => n,Set(FULLFRM=${MESSAGE(from)})
 same => n,Set(CUTFROM=${CUT(FULLFRM,:,2)}) ; to cut off xmpp:
 same => n,Set(CHLCONTACT=${CUT(CUTFROM,/,1)}) ; to cut off /resource
;********************************************************************************
 same => n(jabbersource),NoOp()
 same => n,GotoIf($["${CHLACCOUNT}" ="${CHLCONTACT}"]?chlexit:jabberacct)
;********************************************************************************
 same => n(jabberacct),NoOp()
 same => n,Set(IQUERY=SELECT CHLSystem FROM CHLSystem WHERE CHLData='${CHLACCOUNT}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLACCNAME)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(jabberacctcheck),NoOp()
 same => n,GotoIf($["${CHLACCNAME}" =""]?chladminerror:logchat)
;********************************************************************************
 same => n(logchat),NoOp(****)
 same => n,Set(CHLCHATDATA=${FILTER(${CHATCHAR},${CHLCHAT})})
 same => n,Set(IQUERY=INSERT INTO CHLMessaging (`CHLService`, `CHLContact`, `CHLKey`, `CHLType`, `CHLStatus`, `CHLContent`, `CHLTime`) VALUES ('System', '${CHLCONTACT}', '${SESSKEY}', 'Chat', 'Reading', '${CHLCHATDATA}', UNIX_TIMESTAMP()))
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chlservicekey),NoOp()
 same => n,Set(IQUERY=SELECT CHLKey FROM CHLServices WHERE CHLExten='${CHLACCNAME}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLSERVICE)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlservicecheck),NoOp()
 same => n,GotoIf($["${CHLSERVICE}" =""]?chladminerror:chlinvitation)
;********************************************************************************
 same => n(chlinvitation),NoOp()
 same => n,Set(IQUERY=SELECT * FROM CHLMessaging WHERE CHLContent LIKE '%invites you to the room%' AND CHLKey='${SESSKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLINVITE)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlinvitationcheck),NoOp()
 same => n,GotoIf($["${CHLINVITE}" =""]?chlchatkey:chlaccept)
;********************************************************************************
 same => n(chlaccept),NoOp()
 same => n,Hangup()
;********************************************************************************
;
;********************************************************************************
 same => n(chlchatkey),NoOp()
 same => n,Set(IQUERY=SELECT CHLKey FROM CHLContact WHERE CHLContact LIKE '%${CHLCONTACT}%')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLKEY)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlkeycheck),NoOp()
 same => n,GotoIf($["${CHLKEY}" =""]?chlregistry:chlregstatus)
;********************************************************************************
;
;********************************************************************************
 same => n(chlregstatus),NoOp()
 same => n,Set(IQUERY=SELECT CHLNames FROM CHLUsers WHERE CHLKey='${CHLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLNAMES)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlinternalcheck),NoOp()
 same => n,GotoIf($["${CHLNAMES}" =""]?chlexternal:chlinternalset)
;********************************************************************************
 same => n(chlinternalset),NoOp()
 same => n,Set(CHLINTERNAL=On)
 same => n,Goto(chlold)
;********************************************************************************
;
;********************************************************************************
 same => n(chlexternal),NoOp()
 same => n,Set(IQUERY=SELECT CHLKey FROM CHLAddress WHERE CHLEmail LIKE '%${CHLCONTACT}%' ORDER BY RAND() LIMIT 0,1)
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLCALLKEY)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlexternalkey),NoOp()
 same => n,GotoIf($["${CHLCALLKEY}" =""]?chladdresset:chlmenupath)
;********************************************************************************
 same => n(chlmenupath),NoOp()
 same => n,Set(IQUERY=SELECT CHLStatus FROM CHLContact WHERE CHLKey='${CHLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLSTATUS)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlmenupathcheck),NoOp()
 same => n,GotoIf($["${CHLSTATUS}" ="Incomplete"]?chlmenulog:chlold)
;********************************************************************************
 same => n(chlmenulog),NoOp()
 same => n,Set(IQUERY=SELECT CHLData FROM CHLMenuLog WHERE CHLKey='${CHLKEY}' AND CHLMenu='Chat' ORDER BY id DESC LIMIT 0,1)
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLDATA)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlmenulogcheck),NoOp(**names::phone::gender::age**)
 same => n,GotoIf($["${CHLDATA}" =""]?chladminerror:chatregis${CHLDATA})	;clean up at this point	
;********************************************************************************
;
;********************************************************************************
 same => n(chatregisnames),NoOp(**${CHLCHATDATA}**)
 same => n,Set(CHLDATA=confnames)
 same => n,Set(CHLREPLIES=I have your names as follows: ${CHLCHATDATA}. If this is correct, reply with 1. To make changes to your names, reply with 2.)
 same => n,Set(CHLPATH=menu)
 same => n,Set(IQUERY=UPDATE CHLAddress SET CHLNames='${CHLCHATDATA}' WHERE CHLKey='${CHLCALLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatregisconfnames),NoOp()
 same => n,GotoIf($["${CHLCHATDATA}" ="1"]?chatgender:chatresetnames)
;********************************************************************************
 same => n(chatresetnames),NoOp()
 same => n,Set(CHLREPLIES=To continue, reply with your names.)
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLDATA=names)
 same => n,Set(IQUERY=UPDATE CHLAddress SET CHLNames='NULL' WHERE CHLKey='${CHLCALLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatgender),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLDATA=gender)
 same => n,Set(CHLREPLIES=${CHATREPLIES}\\nI need to know your gender. Here are your options.\\nIf you are male, reply with 1. If you are female, reply with 2.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatregisgender),NoOp()
 same => n,Set(CHLDATA=confgender)
 same => n,Set(CHLGENDER=${FILTER(${NUMCHAR},${CHLCHATDATA})})
 same => n,GotoIf($["${CHLGENDER}" ="1"|"${CHLGENDER}" ="2"]?:chatgenderfail)
 same => n,GotoIf($["${CHLGENDER}" ="1"]?gendermale:genderfemale)
;********************************************************************************
 same => n(genderfemale),NoOp()
 same => n,Set(CHLGENDER=Female)
 same => n,Set(CHLSALUTE=Ms)
 same => n,Goto(chatgenderlog)
;********************************************************************************
 same => n(gendermale),NoOp()
 same => n,Set(CHLGENDER=Male)
 same => n,Set(CHLSALUTE=Mr)
;********************************************************************************
 same => n(chatgenderlog),NoOp()
 same => n,Set(IQUERY=UPDATE CHLAddress SET CHLGender='${CHLGENDER}', CHLTitle='${CHLSALUTE}' WHERE CHLKey='${CHLCALLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chatage)
;********************************************************************************
 same => n(chatgenderfail),NoOp()
 same => n,Set(CHLREPLIES=Your reply is not valid. Reply with numbers only.)
 same => n,Goto(chatgender)
;********************************************************************************
 same => n(chatage),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLDATA=age)
 same => n,Set(CHLREPLIES=${CHATREPLIES}\\nI need to know your age. Please reply with your age, as a number. For example, if you are ninenteen years old, reply with 19.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatregisage),NoOp()
 same => n,Set(CHLAGE=${FILTER(${NUMCHAR},${CHLCHATDATA})})
 same => n,GotoIf($["${CHLAGE}" =""]?chatagefail)
 same => n,Set(IQUERY=UPDATE CHLAddress SET CHLAge='${CHLAGE}' WHERE CHLKey='${CHLCALLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chatphone)
;********************************************************************************
 same => n(chatagefail),NoOp()
 same => n,Set(CHLREPLIES=Your age is not valid. Reply with numbers only.)
 same => n,Goto(chatage)
;********************************************************************************
 same => n(chatphone),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLDATA=phone)
 same => n,Set(CHLREPLIES=${CHATREPLIES}\\nTo complete your registration process, I would like you to provide a valid phone number, including the country code. I will send you an SMS for confirmation.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatregisphone),NoOp()
 same => n,Set(CHLPHONE=${FILTER(${NUMCHAR},${CHLCHATDATA})})
 same => n,GotoIf($["${CHLPHONE}" =""]?chatphonefail:chatphonekey)
;********************************************************************************
 same => n(chatphonefail),NoOp()
 same => n,Set(CHLREPLIES=The telephone contact you provided is not valid. Your replies must be numbers only.)
 same => n,Goto(chatphone)
;********************************************************************************
 same => n(chatphonekey),NoOp()
 same => n,Set(IQUERY=SELECT CHLKey FROM CHLContact WHERE CHLContact LIKE '%${CHLPHONE}%' AND CHLType='Cell Phone')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLPHONEKEY)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chatphonekeycheck),NoOp()
 same => n,GotoIf($["${CHLPHONEKEY}" =""]?chatlogphone:confphone)
;********************************************************************************
 same => n(chatlogphone),NoOp()
 same => n,Set(CHLKEYID=)
 same => n,Set(CHLCELLKEY=${RAND(123456789,987654321)})
 same => n,Set(IQUERY=SELECT CHLStatus FROM CHLContact WHERE CHLKey='${CHLCELLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLKEYID)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chatlogphonecheck),NoOp()
 same => n,GotoIf($["${CHLKEYID}" =""]?chlcellkeylog:chatlogphone)
;********************************************************************************
 same => n(chlcellkeylog),NoOp()
 same => n,Set(IQUERY=INSERT INTO CHLContact VALUES ('${CHLCELLKEY}', '${CHLCHATDATA}', '${CHLKEY}', 'Cell Phone', '0', 'Incomplete', UNIX_TIMESTAMP()))
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(confsmsphone),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLDATA=smsphone)
 same => n,Set(CHLREPLIES=${CHLREPLIES}\\nI have sent you a confirmation code to the mobile number you provided. Reply with the confirmation code. If you did not receive it, reply with 0.)
 same => n,Set(CHATSMS=Confirmation Code: ${CHLCELLKEY}. Child Helpline.)
 same => n,Goto(chatsms)
;********************************************************************************
 same => n(chatregissmsphone),NoOp()
 same => n,Set(IQUERY=SELECT CHLKey FROM CHLContact WHERE CHLParent='${CHLKEY}' AND CHLType='Cell Phone')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLCELLKEY)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(checksmsphone),NoOp(**${SMSPHONE}:=:${CHLCELLKEY}**)
 same => n,Set(SMSPHONE=${FILTER(${NUMCHAR},${CHLCHATDATA})})
 same => n,GotoIf($["${SMSPHONE}" ="${CHLCELLKEY}"]?chatsmsphonefail:regisupgrade)
;********************************************************************************
 same => n(chatsmsphonefail),NoOp()
 same => n,Set(CHLREPLIES=The confirmation you provided is not valid. Your replies must be numbers only.)
 same => n,Goto(confsmsphone)
;********************************************************************************
 same => n(confphone),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLDATA=confphone)
 same => n,Set(CHLREPLIES=${CHATREPLIES}\\nThe number you provided already exists in the database and linked with another messaging account.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatregisconfphone),NoOp()
;********************************************************************************
 same => n(regisupgrade),NoOp()
 same => n,Set(CHLREPLIES=Congratulations! Your registration is complete.)
 same => n,Set(IQUERY=UPDATE CHLContact SET CHLStatus='Available' WHERE CHLParent='${CHLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chlexternalnames)
;********************************************************************************
 same => n(chatsms),NoOp()
 same => n,Set(IQUERY=INSERT INTO CHLMessaging VALUES (NULL, 'System', '${CHLCONTACT}', '${CHLKEY}', 'SMS', 'Outbox', '0', '${CHLSMS}', UNIX_TIMESTAMP()))
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chlaccname)
;********************************************************************************
;
;********************************************************************************
 same => n(chlexternalnames),NoOp()
 same => n,Set(IQUERY=SELECT CHLNames FROM CHLAddress WHERE CHLEmail LIKE '%${CHLCONTACT}%')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLNAMES)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlexternalcheck),NoOp()
 same => n,GotoIf($["${CHLNAMES}" =""|"${CHLNAMES}" ="NULL"]?chladminerror:chlold)
;********************************************************************************
 same => n(chlold),NoOp()
 same => n,Set(IQUERY=SELECT id FROM CHLMenuLog WHERE CHLKey='${CHLKEY}' AND CHLStatus='0' ORDER BY id DESC LIMIT 0,1)
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLOLDID)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chloldcheck),NoOp()
 same => n,GotoIf($["${CHLOLDID}" =""]?chlmenu)
 same => n,GotoIf($["${CHLINTERNAL}" ="On"]?chlastmenu:chltime)
;********************************************************************************
 same => n(chltime),NoOp()
 same => n,Set(IQUERY=SELECT CHLTime FROM CHLMenuLog WHERE id='${CHLOLDID}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLTIME)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chltimecheck),NoOp()
 same => n,GotoIf($["${CHLTIME}" = ""]?chlmenu:chlastime)
;********************************************************************************
 same => n(chlastime),NoOp()
 same => n,Set(CHLASTIME=$[${EPOCH}-${CHLTIME}])
 same => n,GotoIf($["${CHLASTIME}" >= 3000]?chlstatusmenu:chlastmenu)
;********************************************************************************
 same => n(chlstatusmenu),NoOp(****)
 same => n,Set(CHLREPLIES=You've been gone for more than 5 minutes.\\nIf you want to continue from where we left from, reply with yes.\\nTo start a new chat, reply with no.)
 same => n,Set(CHLPATH=gonelong)
 same => n,Set(IQUERY=UPDATE CHLMenuLog SET CHLStatus=CHLStatus+1 WHERE CHLKey='${CHLKEY}' AND CHLStatus='0' AND CHLMenu='Chat')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chlrequestname),NoOp()
 same => n,Set(CHLREPLIES=It seems you haven't replied with your names. I would ask you to provide us with your names. Kindly do so if you want to continue.)
 same => n,Set(CHLPATH=external)
 same => n,Set(IQUERY=UPDATE CHLMenuLog SET CHLStatus=CHLStatus+1 WHERE CHLKey='${CHLKEY}' AND CHLStatus='0' AND CHLMenu='Chat')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chlaccname)
;********************************************************************************
;
;********************************************************************************
 same => n(chlastmenu),NoOp()
 same => n,Set(IQUERY=SELECT CHLPath FROM CHLMenuLog WHERE id='${CHLOLDID}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLPATH)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlastmenucheck),NoOp()
 same => n,GotoIf($["${CHLPATH}" = ""]?chlmenu:chlastmenuset)
;********************************************************************************
 same => n(chlastmenuset),NoOp()
 same => n,Set(IQUERY=UPDATE CHLMenuLog SET CHLStatus=CHLStatus+1 WHERE id='${CHLOLDID}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chl${CHLPATH})		;chlgonelong::chlmenu::
;********************************************************************************
;
;********************************************************************************
 same => n(chlregistry),NoOp()
 same => n,Set(CHLKEYID=)
 same => n,Set(CHLKEY=${RAND(123456789,987654321)})
 same => n,Set(IQUERY=SELECT CHLStatus FROM CHLContact WHERE CHLKey='${CHLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLKEYID)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlkeysetcheck),NoOp()
 same => n,GotoIf($["${CHLKEYID}" =""]?chlkeylog:chlkeyset)
;********************************************************************************
 same => n(chlkeylog),NoOp()
 same => n,Set(IQUERY=INSERT INTO CHLContact VALUES ('${CHLKEY}', '${CHLCONTACT}', '${CHLKEY}', 'Chat', '1', 'Incomplete', UNIX_TIMESTAMP()))
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chladdresset),NoOp()
 same => n,Set(CHLKEYID=)
 same => n,Set(CHLCALLKEY=${RAND(123456789,987654321)})
 same => n,Set(IQUERY=SELECT CHLContact FROM CHLAddress WHERE CHLKey='${CHLCALLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLKEYID)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chladdresscheck),NoOp()
 same => n,GotoIf($["${CHLKEYID}" =""]?chlregisbasic:chladdresset)
;********************************************************************************
 same => n(chlregisbasic),NoOp()
 same => n,Set(IQUERY=INSERT INTO CHLAddress (CHLKey,CHLEmail,CHLContact,CHLTime) VALUES ('${CHLCALLKEY}', '${CHLCONTACT}', '${CHLKEY}', UNIX_TIMESTAMP()))
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chlwelcome),NoOp()
 same => n,Set(CHLREPLIES=Hello! Thanks for your message to Child Helpline. I am your Virtual Counsellor. I would like to know your names, please. To continue, reply with your names.)
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLDATA=names)
 same => n,Goto(chlaccname)	
;********************************************************************************
;
;********************************************************************************
 same => n(chlgonelong),NoOp()
 same => n,Set(JABBERGOOD=${TOLOWER(${CHLCHAT})})
 same => n,Set(JABBERGOOD=${FILTER(${ALPHACHAR},${JABBERGOOD})})
 same => n,GotoIf($["${JABBERGOOD}" = "yes"]?chlresetgone:chlclearlast)
;********************************************************************************
 same => n(chlclearlast),NoOp()
 same => n,Goto(chlmenu)
;********************************************************************************
 same => n(chlresetgone),NoOp()

 same => n,Goto(chlmenu)
;********************************************************************************
;
;********************************************************************************
 same => n(chlmenu),NoOp(**Off-Quiz**On-Case**On-Q**)
 same => n,Set(CHLPATH=)
 same => n,Set(CHLQUERY=${CHLINTERNAL}-${CHLCHAT})
 same => n,Set(CHLQUERY=${TOLOWER(${CHLQUERY})})
 same => n,Set(IQUERY=SELECT CHLPath FROM CHLSearch WHERE CHLWord LIKE '%${CHLQUERY}%' ORDER BY RAND() LIMIT 0,1)
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLPATH)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlmenucheck),NoOp()
 same => n,GotoIf($["${CHLPATH}" = ""]?:chl${CHLPATH})
 same => n,GotoIf($["${CHLINTERNAL}" = "Off"]?chatexternaltxt:chatinternaltxt)
;********************************************************************************
 same => n(chatinternaltxt),NoOp()
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}! What can I do for you today? Here are your options.\\nCreate a new case, reply with 1.\\nGet case report, reply with 2.\\nLogin or logout of Social Media Queue, reply with 3.\\nTo get a list of search words, reply with word menu, or help.)
 same => n,Set(CHLPATH=menuinternal)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatexternaltxt),NoOp()
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}! What can I do for you today? Here are your options.\\nTo chat with a Counsellor, reply with 1.\\nTo report a case of gender or child abuse, reply with 2.\\nFor fun and games, reply with 3.\\nTo add a messaging a account, for example, Facebook, Twitter, to this account, reply with 4.)
 same => n,Set(CHLPATH=menuexternal)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chlmenuinternal),NoOp()
 same => n,Set(JABBERGOOD=${FILTER(${NUMCHAR},${CHLCHAT})})
 same => n,GotoIf($["${JABBERGOOD}" = "1"|"${JABBERGOOD}" = "2"|"${JABBERGOOD}" = "3"]?:chlmenu)
 same => n,GotoIf($["${JABBERGOOD}" = "1"]?chatcasecreate)
 same => n,GotoIf($["${JABBERGOOD}" = "2"]?chatreport:chatqueueset)
;********************************************************************************
 same => n(chlmenuexternal),NoOp()	
 same => n,Set(JABBERGOOD=${FILTER(${NUMCHAR},${CHLCHAT})})
 same => n,GotoIf($["${JABBERGOOD}" = "1"|"${JABBERGOOD}" = "2"|"${JABBERGOOD}" = "3"|"${JABBERGOOD}" = "4"]?:chlmenu)
 same => n,GotoIf($["${JABBERGOOD}" = "1"]?chatrelay)
 same => n,GotoIf($["${JABBERGOOD}" = "2"]?chatselfreport)
 same => n,GotoIf($["${JABBERGOOD}" = "3"]?chatgeneric:chataccadmin)
;********************************************************************************
;
;********************************************************************************
 same => n(chataccadmin),NoOp(**AccType::Google, Facebook, Twitter**)
 same => n,Set(CHLREPLIES=Account Management Menu. Here are your options.\\nTo add a new Google account, reply with 1. To add a new Facebook account, reply with 2. To link Twitter to this account, reply with 3.)
 same => n,Set(CHLPATH=accadmincheck)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(accadmincheck),NoOp()
 same => n,Set(JABBERGOOD=${FILTER(${NUMCHAR},${CHLCHAT})})
 same => n,GotoIf($["${JABBERGOOD}" = "1"|"${JABBERGOOD}" = "2"|"${JABBERGOOD}" = "3"]?:accadminfail)
 same => n,GotoIf($["${JABBERGOOD}" = "1"]?adminaddgoog)
 same => n,GotoIf($["${JABBERGOOD}" = "2"]?adminaddfb:adminaddtwitt)
;********************************************************************************
 same => n(adminaddgoog),NoOp()
 same => n,Set(LINKACCT=gmail.com)
; same => n,Set(CHLREPLIES=)
 same => n,Goto(adminacclink)
;********************************************************************************
 same => n(adminaddfb),NoOp()
 same => n,Set(LINKACCT=chat.facebook.com)
; same => n,Set(CHLREPLIES=)
 same => n,Goto(adminacclink)
;********************************************************************************
 same => n(adminaddtwitt),NoOp()
 same => n,Set(LINKACCT=twitter.com)
; same => n,Set(CHLREPLIES=)
 same => n,Goto(adminacclink)
;********************************************************************************
 same => n(adminacclink),NoOp()
 same => n,Set(CHLPATH=caseid)
 same => n,Set(CHLREPLIES=)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(accadminfail),NoOp()
 same => n,Goto(chlaccname)
;********************************************************************************
;
;********************************************************************************
 same => n(chatcasecreate),NoOp()
; same => n,Set(CHLPATH=caseid)
; same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nYou are now ready to create your case.\\nChild Helpline Support.)
; same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chlcaseid),NoOp()
 same => n,Set(IQUERY=SELECT CHLCase FROM CHLUsers WHERE CHLKey='${CHLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLCASEID)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlcaseidcheck),NoOp()
 same => n,GotoIf($["${CHLCASEID}" = "0"]?chatcreatecaseid:chlverifystatus)
;********************************************************************************
 same => n(chlverifystatus),NoOp()
 same => n,Set(IQUERY=SELECT CHLData FROM CHLCases WHERE CHLCase='${CHLCASEID}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLCASEDATA)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlverifystatuscheck),NoOp()
 same => n,GotoIf($["${CHLCASEDATA}" = "Chat"]?chlcreatenextitem:chatcreatecaseid)
;********************************************************************************
 same => n(chatcreatecaseid),NoOp()
 same => n,Set(IQUERY=INSERT INTO CHLCases (CHLUnique, CHLType, CHLCreator, CHLData, CHLPopup, CHLTime) VALUES ('${SESSKEY}', 'Delete', '${CHLKEY}', 'Chat', 'Done', UNIX_TIMESTAMP()))
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chlgetcaseid),NoOp()
 same => n,Set(IQUERY=SELECT CHLCase FROM CHLCases WHERE CHLUnique='${SESSKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLCASEID)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chllogcaseuser),NoOp()
 same => n,Set(IQUERY=UPDATE CHLUsers SET CHLCase='${CHLCASEID}' WHERE CHLKey='${CHLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chlcreatenextitem),NoOp()
 same => n,Set(IQUERY=SELECT CHLRegistry FROM CHLCases WHERE CHLCase='${CHLCASEID}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLREGISTRY)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlcreatenextitemid),NoOp()
 same => n,Set(CHLREGISTRY=$[${CHLREGISTRY}+1])
 same => n,Set(IQUERY=SELECT CHLChat FROM CHLIMRegistry WHERE CHLIndex='${CHLREGISTRY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLNEXTITEM)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlcreatenextitemcat),NoOp()
 same => n,Set(IQUERY=SELECT CHLPath FROM CHLIMRegistry WHERE CHLIndex='${CHLREGISTRY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLPATH)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlcreatereply),NoOp()
 same => n,Set(IQUERY=INSERT INTO CHLMenuLog VALUES (NULL, '${CHLKEY}', '${CHLCASEID}', '${CHLREGISTRY}', 'Chat', 'Case Create', '${CHLNEXTITEM}', '${CHLCHAT}', UNIX_TIMESTAMP()))
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chlregisupdate),NoOp()
 same => n,Set(IQUERY=UPDATE CHLCases SET CHLRegistry='${CHLREGISTRY}' WHERE CHLCase='${CHLCASEID}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chlcreatereplyset),NoOp()
 same => n,Set(CHLREPLIES=Registration Item ${CHLREGISTRY}:\\n${CHLNEXTITEM})
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chlcasecompile),NoOp()
 same => n,Set(IQUERY=UPDATE CHLUsers SET CHLCase='0' WHERE CHLKey='${CHLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chlexitcase),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Registration Item ${CHLREGISTRY}:\\nEnd of Social Media-based Case Registration. Here is the case summary\\n)
 same => n,Goto(chlaccname)
;********************************************************************************
;
;********************************************************************************
 same => n(chatreport),NoOp()
 same => n,Set(CHLPATH=report)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nReport Menu.\\nChild Helpline Support.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chlreport),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nEnd of Child Helpline Reports.\\nChild Helpline Support.)
 same => n,Goto(chlaccname)
;********************************************************************************
;
;********************************************************************************
 same => n(chatqueueset),NoOp()
 same => n,Set(IQUERY=SELECT CHLStatus FROM CHLSchedule WHERE CHLService='${CHLSERVICE}' AND CHLKey='${CHLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLSCHEDULE)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chatqueuesetcheck),NoOp()
 same => n,GotoIf($["${CHLSCHEDULE}" = ""]?chatqueuefail)
 same => n,Set(CHLPATH=menu)
 same => n,Set(JABBERGOOD=${TOLOWER(${CHLSCHEDULE})})
 same => n,Goto(chatqueue${CHLSCHEDULE})
;********************************************************************************
 same => n(chatqueueoffline),NoOp()
 same => n,Set(IQUERY=UPDATE CHLSchedule SET CHLStatus='Online' WHERE CHLService='${CHLSERVICE}' AND CHLKey='${CHLKEY}' AND CHLStatus='Offline')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chatqueueonmsg),NoOp()
 same => n,Set(CHLREPLIES=Welcome ${CHLNAMES}!\\nYour login to the Social Media Queue has been successful. Looking forward to a good chit chat!\\nChild Helpline Support.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatqueueonline),NoOp()
 same => n,Set(IQUERY=UPDATE CHLSchedule SET CHLStatus='Offline' WHERE CHLService='${CHLSERVICE}' AND CHLKey='${CHLKEY}' AND CHLStatus='Online')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chatqueueoffmsg),NoOp()
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nYour logout of the Social Media Queue has been successful. Have a good day and bye!\\nChild Helpline Support.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatqueuefail),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nI am sorry! I didn't find any schedule for you in the Social Media Queues. Try and talk to your Supervisor about assigning you to the wonderful Social Media Queue.\\nChild Helpline.)
 same => n,Goto(chlaccname)
;********************************************************************************
;
;********************************************************************************
 same => n(chatrelay),NoOp()
 same => n,Set(IQUERY=SELECT COUNT(id) FROM CHLSchedule WHERE CHLService='${CHLSERVICE}' AND CHLStatus='Online')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLRELAYCOUNT)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chatrelaycount),NoOp()
 same => n,GotoIf($["${CHLRELAYCOUNT}" =""|"${CHLRELAYCOUNT}" ="0"]?chatnosupport:chatbookroom)
;********************************************************************************
 same => n(chatnosupport),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nThere is no one here for one-on-one live chat. I am really sorry! To use our Bible quotes, quizzes, jokes & horoscope menu, reply with the word fun.\\nChild Helpline Support.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatbookroom),NoOp()
 same => n,Set(IQUERY=INSERT INTO CHLMessaging VALUES (NULL, '${CHLNAMES}', '${CHLKEY}', 'Chat', 'Conference request ID: ${CHCONTACT}', '0', '', UNIX_TIMESTAMP()))
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chatbooknotify),NoOp()
 same => n,Set(CHLPATH=externalroom)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nI have requested for one of our Counsellors to have a one-on-one confidential chat with you as soon as possible. Please be patient.\\nChild Helpline Support.)
 same => n,Goto(chlaccname)
;********************************************************************************
;
;********************************************************************************
 same => n(chlconfmenu),NoOp()
 same => n,Set(IQUERY=SELECT CHLStatus FROM CHLChatroom WHERE CHLRoom='${CHLCONTACT}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} ROOMSTATUS)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlconfmenucheck),NoOp()
 same => n,GotoIf($["${ROOMSTATUS}" =""]?chlconfrefuse)
 same => n,GotoIf($["${ROOMSTATUS}" ="Waiting"]?chlconfjoin)
 same => n,GotoIf($["${ROOMSTATUS}" ="Expired"]?chlinternalexpire)
 same => n,GotoIf($["${ROOMSTATUS}" ="AgentOff"]?chlconfagenton:chlagentchat)
;********************************************************************************
 same => n(chlagentchat),NoOp()
 same => n,Set(IQUERY=SELECT CHLContact FROM CHLChatroom WHERE CHLRoom='${CHLCONTACT}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHATPEER)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlagentchatcheck),NoOp()
 same => n,GotoIf($["${CHATPEER}" =""]?chladminerror)
;********************************************************************************
 same => n(chlagentchatsend),NoOp()
 same => n,Set(CHLPATH=room)
 same => n,JabberSend(${CHLACCNAME},${CHATPEER},${CHLCHAT})
 same => n,Goto(chlchatlog)
;********************************************************************************
 same => n(chlconfagenton),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Glad you are back!\\nChild Helpline Support.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chlinternalexpire),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Conference Notification\\nI am sorry, your chat session has expired.\\nChild Helpline Support.)
 same => n,Goto(chlroomclose)
;********************************************************************************
 same => n(chlconfrefuse),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Conference Notification\\nI am sorry, your chat session has not been sanctioned because you do not have any active chat. I humbly refuse your invitation. Sorry!\\nChild Helpline Support.)
 same => n,JabberJoin(${CHLACCNAME},${CHLCONTACT},AdminAlert)
 same => n,Wait(2)
 same => n,JabberSend(${CHLACCNAME},${CHLCONTACT},${CHLREPLIES})
 same => n,Wait(2)
 same => n,JabberLeave(${CHLACCNAME},${CHLCONTACT},AdminAlert)
 same => n,Goto(chlchatlog)
;********************************************************************************
 same => n(chlconfjoin),NoOp()
 same => n,Set(JABBERPHP=${URIENCODE(${CHLCHAT})})
 same => n,Set(JABBERHTTP=${CURL(http://localhost/CHLWeb/chat/cases/index.php?reqID=muc&jabberID=${JABBERPHP})})
 same => n,GotoIf($["${JABBERHTTP}" ="No-Data"]?chladminerror)
;********************************************************************************
 same => n(chlconfacc),NoOp()
 same => n,Set(IQUERY=SELECT CHLJabber FROM CHLUsers WHERE CHLEmail='${CHLACCOUNT}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLACCONF)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlconfjoinset),NoOp()
 same => n,GotoIf($["${CHLACCONF}" =""]?chladminerror)
 same => n,JabberJoin(${CHLACCONF},${CHLCONTACT},ChatMaster)
;********************************************************************************
 same => n(chlconfjoinlog),NoOp()
 same => n,Set(IQUERY=UPDATE CHLChatroom SET CHLStatus='AgentOn', CHLStaff='${JABBERHTTP}' WHERE CHLRoom='${CHLCONTACT}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chlconfinform),NoOp()
 same => n,Set(IQUERY=SELECT CHLContact FROM CHLChatroom WHERE CHLRoom='${CHLCONTACT}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLCONTACT)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlconfrelayacc),NoOp()
 same => n,Set(IQUERY=SELECT CHLContact FROM CHLChatroom WHERE CHLRoom='${CHLCONTACT}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHLCONTACT)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlconfinvite),NoOp()
 same => n,Set(CHLPATH=room)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nI have a Counsellor waiting to have a one-on-one chat with you. The information you provide will be confidential. You can start your chat.)
 same => n,JabberSend(${CHLACCNAME},${CHLCONTACT},${CHLREPLIES})
 same => n,Goto(chlchatlog)
;********************************************************************************
;
;********************************************************************************
 same => n(chlroom),NoOp()
 same => n,Set(IQUERY=SELECT CHLIndex FROM CHLChatroom WHERE CHLKey='${CHLKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHATINDEX)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlroomcheck),NoOp()
 same => n,GotoIf($["${CHATINDEX}" =""]?chatroomerror:chlroomstatus)
;********************************************************************************
 same => n(chlroomstatus),NoOp()
 same => n,Set(IQUERY=SELECT CHLStatus FROM CHLChatroom WHERE CHLIndex='${CHATINDEX}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,MYSQL(Fetch FETCHID ${RESULTID} CHATSTATUS)
 same => n,MYSQL(Clear ${RESULTID})
;********************************************************************************
 same => n(chlroomstatuscheck),NoOp()
 same => n,GotoIf($["${CHATSTATUS}" =""]?chatroomerror)
 same => n,Set(CHLQUERY=${TOLOWER(${CHATSTATUS})})
 same => n,Goto(chatroom${CHATSTATUS})	;'Expired','Waiting','AgentOn','AgentOff'
;********************************************************************************
 same => n(chatroomerror),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nWe have experienced a technical problem, therefore, your last live chat has been cancelled. Sorry about that!\\nChild Helpline Support.)
 same => n,Goto(chlroomclose)
;********************************************************************************
 same => n(chatroomexpired),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nI am sorry, your chat session has expired.\\nChild Helpline Support.)
 same => n,Goto(chlroomclose)
;********************************************************************************
 same => n(chatroomwaiting),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nI am still waiting to locate an available Counsellor for one-on-one chat. Be patient. To cancel this session, reply with word cancel.\\nChild Helpline Support.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatroomagentoff),NoOp()
 same => n,Set(CHLPATH=externalroom)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nSeems like the Counsellor you were chatting with has left the chat room. I have closed this session.\\nChild Helpline Support.)
 same => n,Goto(chlroomclose)
;********************************************************************************
 same => n(chlroomclose),NoOp()
 same => n,Set(IQUERY=DELETE FROM CHLChatroom WHERE CHLIndex='${CHATINDEX}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chatroomagenton),NoOp()
 same => n,Set(CHLPATH=room)
 same => n,JabberSendGroup(${CHLACCNAME},${CHLCONTACT},${CHLCHAT})
 same => n,Goto(chlchatlog)		;we skip replies to sender
;********************************************************************************
;
;********************************************************************************
 same => n(chlexternalroom),NoOp(**Figure out how to grab conference details**)
 same => n,Set(CHLPATH=menu)
 same => n,JabberSendGroup(${CHLACCNAME},${CHLCONTACT},${CHLCHAT})
 same => n,Goto(chlchatlog)		;we skip replies to sender
;********************************************************************************
;
;********************************************************************************
 same => n(chatselfreport),NoOp()
 same => n,Set(CHLPATH=selfreport)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\n)
 same => n,Goto(chlaccname)	
;********************************************************************************
 same => n(chlselfreport),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\n)
 same => n,Goto(chlaccname)
;********************************************************************************
;
;********************************************************************************
 same => n(chatgeneric),NoOp()
 same => n,Set(CHLPATH=generic)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\n.)
 same => n,Goto(chlaccname)	
;********************************************************************************
 same => n(chlgeneric),NoOp()
 same => n,Set(CHLPATH=menu)
 same => n,Set(CHLREPLIES=Hi ${CHLNAMES}!\\nThank you for interest in our services.\\nChild Helpline Support.)
 same => n,Goto(chlaccname)
;********************************************************************************
 same => n(chlgenericsave),NoOp()
 same => n,GotoIf($["${CHLCHAT}" = "1"|"${CHLCHAT}" = "2"|"${CHLCHAT}" = "3"]?chlmenu)
 same => n,GotoIf($["${CHLCHAT}" = "1"]?)
 same => n,GotoIf($["${CHLCHAT}" = "2"]?)
;********************************************************************************
;
;********************************************************************************
 same => n(chlaccname),NoOp()
 same => n,System(echo "${CHLREPLIES}" > /opt/asterisk/CHLCore/callFiles/${CHLKEY}.chat)
 same => n,Set(CHLREPLIES=${FILE(/opt/asterisk/CHLCore/callFiles/${CHLKEY}.chat)})
 same => n,System(rm /opt/asterisk/CHLCore/callFiles/${CHLKEY}.chat)
 same => n,JabberSend(${CHLACCNAME},${CHLCONTACT},${CHLREPLIES})
;********************************************************************************
 same => n(chlchatlog),NoOp()
 same => n,Set(IQUERY=UPDATE CHLMessaging SET CHLKey='${CHLKEY}', CHLStatus='Inbox' WHERE CHLKey='${SESSKEY}')
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chlsenderlog),NoOp()
 same => n,Set(IQUERY=INSERT INTO CHLMenuLog VALUES (NULL, '${CHLKEY}', '${CHLKEY}', '0', 'Chat', '${CHLPATH}', '', '${CHLDATA}', UNIX_TIMESTAMP()))
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
 same => n,Goto(chlexit)
;********************************************************************************
;
;********************************************************************************
 same => n(chladminerror),NoOp()
 same => n,Set(IQUERY=INSERT INTO CHLMessaging  VALUES (NULL, 'System Adminstrator', '111111111', 'Chat', 'Inbox', '0', 'System Account Notification. Account information for ${CHLACCOUNT} is corrupted! Notify the Adminstrator urgently.', UNIX_TIMESTAMP()))
 same => n,MYSQL(Query RESULTID ${CONNID} ${IQUERY})
;********************************************************************************
 same => n(chlexit),NoOp()
 same => n,MYSQL(Disconnect ${CONNID})
 same => n,Hangup()
;********************************************************************************
;
;********************************************************************************
