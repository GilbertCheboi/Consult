{% load i18n %}
{% load static %}
{% load notifications_tags %}
{% load humanize %}
{% load crispy_forms_tags %}
{% load avatar_tags %}
{% load selectable_tags %}
{% load django_tables2 %}
{% load account %}
{% load static %}
{% load hijack %}
{% load socialaccount %}
{% notifications_unread as unread_count %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{% block helpline_title %}Helpline{% endblock %}</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    {% block styles %}
    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" href="{% static "bootstrap/dist/css/bootstrap.min.css" %}">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{% static "font-awesome/css/font-awesome.min.css" %}">
    <!-- Ionicons -->
    <link rel="stylesheet" href="{% static "Ionicons/css/ionicons.min.css" %}">
    <!-- jvectormap -->
    <link rel="stylesheet" href="{% static "AdminLTE/plugins/jvectormap/jquery-jvectormap-1.2.2.css" %}">
    <!-- Theme style -->
    <link rel="stylesheet" href="{% static "AdminLTE/dist/css/AdminLTE.min.css" %}">
    <!-- DataTables -->
    <link rel="stylesheet" href="{% static "AdminLTE/dist/css/skins/_all-skins.min.css" %}">

     <!-- Google Font Link for Icons -->
     <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">

    <link rel="stylesheet" href="{% static "toastr/toastr.min.css" %}">
    <link rel="stylesheet" href="{% static 'jquery-ui/themes/ui-lightness/jquery-ui.css' %}" type="text/css" />
    <link href="{% static 'selectable/css/dj.selectable.css' %}" type="text/css" media="all" rel="stylesheet" />
    <link href="{% static 'AdminLTE/plugins/datatables/jquery.dataTables.min.css' %}" rel="stylesheet">
    <link href="{% static 'tellme/vendor/feedback/feedback.css' %}" rel="stylesheet">

    <link rel="stylesheet" href="{% static "helpline/css/style.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "collection_crm/css/formstyle.css" %}" />
		<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans:400,700'>
		<link rel="stylesheet" type="text/css" href="{% static "collection_crm/css/gauge_style.css" %}"/>

    {% endblock styles %}

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    {% block additional-headers %}{% endblock %}

    <!-- jQuery 2.2.3 -->
    <script src="{% static "jquery/dist/jquery.min.js" %}"></script>
    <script src="{% static "jquery-ui/ui/jquery-ui.js" %}"></script>
    <script type="text/javascript" src="{% static 'selectable/js/jquery.dj.selectable.js' %}"></script>
    <script src="{% static 'clipboard/dist/clipboard.min.js' %}" type="text/javascript"></script>
    <script type="text/javascript" src="{% static 'helpline/js/codedance/jquery.are-you-sure.js' %}"></script>
    <script src="{% static "howler.js/dist/howler.min.js" %}"></script>
    <script src="https://unpkg.com/wavesurfer.js"></script>

    {% block head %}{% endblock head %}
    <style type="text/css">

/* The switch - the box around the slider */
.switch {
  position: relative;
  display: inline-block;
  width: 40px;
  height: 24px;
}
/* Hide default HTML checkbox */
.switch input {display:none;}

/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #f00;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}
input:checked + .slider {
  background-color: #2196F3;
}

input:focus + .slider {
  box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
  -webkit-transform: translateX(16px);
  -ms-transform: translateX(16px);
  transform: translateX(16px);
}
/* Rounded sliders */
.slider.round {
  border-radius: 28px;
}

.slider.round:before {
  border-radius: 50%;
}

.rotate-135 {
  transform:rotate(135deg)
}

.btn-round,
.btn-round-big,
.btn-round-xxl {
  margin:4px;
  border-radius:50%;
  opacity:.9
}
.btn-round {
  width:45px;
  height:45px;
  font-size:20px
}
.btn-round-big {
  width:55px;
  height:55px;
  font-size:22px
}
.btn-round-xxl {
  width:65px;
  height:65px;
  font-size:24px
}
.vertical-right-aligned {
  transform: rotate(-90deg);
  transform-origin: 100% 100%;
  position: fixed;
  right: 0;
  top: 50%;
  z-index: 100;
}
              .social-video {
                width: 100%;
                height: auto;
              }

              td.details-control {
                background: url('{% static "helpline/images/details_open.png" %}') no-repeat center center;
                cursor: pointer;
              }

              tr.shown td.details-control {
                background: url('{% static "helpline/images/details_close.png" %}') no-repeat center center;
              }

              tr.loading td {
                text-align: center;
              }
	/** calender */
	.cal_body{
  display: flex;
  align-items: center;
  padding: 0 10px;
  #justify-content: center;
  #min-height: 90vh;
  #background: #9B59B6;
}
	.cal_wrapper{
  width: 450px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.12);
}
.cal_wrapper header{
  display: flex;
  align-items: center;
  padding: 25px 30px 10px;
  justify-content: space-between;
}
.cal_wrapper header .cal_icons{
  display: flex;
}
.cal_wrapper header .cal_icons span{
  height: 38px;
  width: 38px;
  margin: 0 1px;
  cursor: pointer;
  color: #878787;
  text-align: center;
  line-height: 38px;
  font-size: 1.9rem;
  user-select: none;
  border-radius: 50%;
}
.icons span:last-child{
  margin-right: -10px;
}
.cal_wrapper header .cal_icons span:hover{
  background: #f2f2f2;
}
.cal_wrapper header .current-date{
  font-size: 1.45rem;
  font-weight: 500;
}
.calendar{
  padding: 20px;
}
.calendar ul{
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  text-align: center;
}
.calendar .days{
  margin-bottom: 20px;
}
.calendar li{
  color: #333;
  width: calc(100% / 7);
  font-size: 1.07rem;
}
.calendar .weeks li{
  font-weight: 500;
  cursor: default;
}
.calendar .days li{
  z-index: 1;
  cursor: pointer;
  position: relative;
  margin-top: 30px;
}
.days li.inactive{
  color: #aaa;
}
.days li.active{
  color: #fff;
}
.days li::before{
  position: absolute;
  content: "";
  left: 50%;
  top: 50%;
  height: 40px;
  width: 40px;
  z-index: -1;
  border-radius: 50%;
  transform: translate(-50%, -50%);
}
.days li.active::before{
  background: #9B59B6;
}
.days li:not(.active):hover::before{
  background: #f2f2f2;
}


<!-- Events -->
button {
  height: 34px;
  width: 70px;
  border-radius: 20px;
  border: 1px solid rgb(20, 20, 237);
  background-color: white;
  color: rgb(20, 20, 237);
}
p {
	font-family: sans-serif;
}
#ceate-btn{
	 background-color: rgb(47, 94, 235);
	 color: white;
	 padding: 0px 10px;
	 border-radius: 10px;
}
#create-btn:active{
	 box-shadow: rgba(0, 0, 0, 0.15) 1.95px 1.95px 2.6px;
}


#headings{
	display: flex;
	gap: 5%;
	padding: 0% 10%;
	box-shadow: rgba(0, 0, 0, 0.24) 0px 2px 1px;
	height: 50px;
}

#secondnavbar-dash{
	    display: flex;
	        font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
		    display: flex;
		    padding: 0% 10%;
		    justify-content: space-between;
		    padding-bottom: 10px;

}

#headings>p{
	    padding-bottom: 15px;
	        border-bottom: solid 3px rgb(59, 59, 255);
}
#headings>p:first-child~p{
	    border: none;
	        color: rgb(122, 114, 114);

}

#headings>p:first-child~p:hover{
	    border-bottom: solid 3px grey;
	        color: black;
}

#secondnavbar-dash p{
	    font-size:180%;
	        margin-top: -4px;

}
#create-btn{
	width: 130px;
	height: 55px;
  border-radius: 10px;
}

#A>input{
	    
	  
	outline: none;
	padding: 0% 10%;
	font-size: 16px;
	border: none;
	margin-top: 20px;
	width: 200px;
}
#B{
	    display: flex;

	        padding: 0% 10%;
		    justify-content: space-between;
		        margin-top: 20px;

}
#new-event-btn{
	    margin-right: 10px;
	    width: 200px;

}

#new-event-btn:hover{
	background-color: rgba(107, 107, 236, 0.142);
}

#url p{
	margin-top: -5px;
	margin-left: 10px;
}
#url p:last-child{
	    margin-top: -10px;
}
#B img:last-child{
	    width:20px;
	        height: 20px;
}
#Name{
	    color: grey;

}

#url>p:last-child{
	    color: rgb(67, 67, 241);
}
#B img:first-child{
	margin-top: -5px;
}


table {
  width: 100%;
  max-width: 1000px;
  border-collapse: collapse;
  margin: 20px auto; /* Center the table on the screen */
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Add a subtle shadow effect */
}

th,
td {
  border: none; /* Remove horizontal borders */
  border-bottom: 1px solid #ddd; /* Add a bottom border for cells */
  padding: 18px;
}

thead {
  background-color: #f2f2f2;
  font-weight: bold;
}
tbody tr:nth-child(even) {
	    background-color: #f9f9f9; /* Alternating row background color */
}


.expand-button,
.call-button {
  padding: 8px 12px;
  font-size: 14px;
  cursor: pointer;
  border-radius: 10px;
}

.expand-button {
  background-color: #4caf50;
  color: white;
  border: none;
}

.call-button {
  background-color: #008cba;
  color: white;
  border: none;
}

/* Media Queries for Responsive Layout */

/* Tablets and larger */
@media screen and (min-width: 768px) {
  table {
    font-size: 16px;
  }

  .expand-button,
  .call-button {
    font-size: 16px;
  }
}

/* Large screens and desktops */
@media screen and (min-width: 1200px) {
  table {
    font-size: 18px;
  }

  .expand-button,
  .call-button {
    font-size: 18px;
  }
}

    </style>

	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138420386-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-138420386-1');
	</script>

  <script type="text/javascript">
    // Create a WaveSurfer instance
    var wavesurfer;

    // Init on DOM ready
    document.addEventListener('DOMContentLoaded', function() {
          wavesurfer = WaveSurfer.create({
                    container: '#waveform',
                    waveColor: '#428bca',
                    progressColor: '#31708f',
                    height: 120,
                    barWidth: 3
                });
    });

    // Bind controls
    document.addEventListener('DOMContentLoaded', function() {
          let playPause = document.querySelector('#playPause');
          playPause.addEventListener('click', function() {
                    wavesurfer.playPause();
                });

          // Toggle play/pause text
          wavesurfer.on('play', function() {
                    document.querySelector('#play').style.display = 'none';
                    document.querySelector('#pause').style.display = '';
                });
          wavesurfer.on('pause', function() {
                    document.querySelector('#play').style.display = '';
                    document.querySelector('#pause').style.display = 'none';
                });

          // The playlist links
          let links = document.querySelectorAll('#cdr_table a');
          let currentTrack = 0;

          // Play on audio load
          wavesurfer.on('ready', function() {
                    wavesurfer.play();
                });

          wavesurfer.on('error', function(e) {
                    console.warn(e);
                });

          // Go to the next track on finish
          wavesurfer.on('finish', function() {
            console.log('finish');
                });

    });
  </script>

  </head>
  <body class="skin-blue sidebar-collapse sidebar-mini" style="height: auto; min-height: 100%;">
      {% if user.is_hijacked %}
      {% include "hijack/notification.html" %}
      {% endif %}

	  <button type="button" id="feedback-btn" class="btn btn-info vertical-right-aligned">
		  Feedback <span class="glyphicon glyphicon-bullhorn" aria-hidden="true"></span>
	  </button>

    <div class="wrapper">

      <header class="main-header">

        <!-- Logo -->
        <a id="dashboard_home_link" href="{% url "dashboard_home" %}" class="logo">
          <!-- mini logo for sidebar mini 50x50 pixels -->
          <span class="logo-mini"><b>C</b>AI</span>
          <!-- logo for regular state and mobile devices -->
          <span class="logo-lg"><b>Consult</b>AI</span>
        </a>

        <!-- Header Navbar: style can be found in header.less -->
        <nav class="navbar navbar-static-top">
          <!-- Sidebar toggle button-->
          <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
            <span class="sr-only">{% trans "Toggle navigation" %}</span>
          </a>
          <!-- Navbar Right Menu -->
          <div class="navbar-custom-menu">
            <ul class="nav navbar-nav">
              <!-- Messages: style can be found in dropdown.less-->
              {% block navbar_nav %}
              <li class="dropdown messages-menu">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="dashboard_stats_att">
                  </a>
              </li>
              <!-- Messages: style can be found in dropdown.less-->
              <li class="dropdown messages-menu">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="dashboard_stats_awt">
                  </a>
              </li>

          <li class="dropdown messages-menu">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" onclick="getLoginDuration();">
                <i class="fa fa-clock-o"></i>  <span id="clock">0:00 AM</span>
            </a>
            <ul class="dropdown-menu">
                <li class="header">
                        <span id="durations"></span>
                </li>
                <li>
                    <ul class="menu">
                        {% for clock in request.user.HelplineUser.get_recent_clocks %}
                        <li>
                        <a href="#">
                            <h4>
                                {{ clock }}
                                <small>
                                    {{ clock.hl_time|timestamp|timesince }} {% trans "ago" %}
                                </small>
                            </h4>
                        </a>
                        </li>
                            {% endfor %}
                    </ul>
                </li>
                <li class="footer">
                </li>
            </ul>
          </li>
              {% endblock navbar_nav %}

              <!-- Notifications: style can be found in dropdown.less -->
              <li class="dropdown notifications-menu">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                      <i class="fa fa-bell-o"></i>
                      {% if unread_count %}
                      <span class="label label-warning">{{ unread_count }}</span>
                      {% endif %}
                  </a>
                  <ul class="dropdown-menu">
                      <li class="header">{% trans "You have" %} {{ unread_count }} {% trans "notification" %}{{ unread_count|pluralize }}.</li>
                      <li>
                          <!-- inner menu: contains the actual data -->
                      </li>
                      <li class="footer"><a href="{% url "notifications:unread" %}">View all</a></li>
                  </ul>
              </li>
              <li class="dropdown notifications-menu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <i class="fa fa-language"></i>
                </a>
                <ul class="dropdown-menu">
                  <!-- Language selection -->
                  <form action="{% url 'set_language' %}" method="post">{% csrf_token %}
                    <input name="next" type="hidden" value="{{ redirect_to }}" />
                    <select name="language">
                      {% get_current_language as LANGUAGE_CODE %}
                      {% get_available_languages as LANGUAGES %}
                      {% get_language_info_list for LANGUAGES as languages %}
                      {% for language in languages %}
                      <option value="{{ language.code }}"{% if language.code == LANGUAGE_CODE %} selected{% endif %} >
                      {{ language.name_local }} ({{ language.code }})
                      </option>
                      {% endfor %}
                    </select>
                    <input type="submit" value="Go" />
                  </form>
                  <!-- Language selection -->
                </ul>

              </li>

              <!-- User Account: style can be found in dropdown.less -->
              <li class="dropdown user user-menu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  {% avatar user 160 class="user-image" %}
                  <span class="hidden-xs"><b>{{ request.user.get_full_name|default:request.user.username }}</b></span>
                  <span class="hidden-xs"><small>@{{ request.user.username }}</small></span>
                </a>
                <ul class="dropdown-menu">
                  <!-- User image -->
                  <li class="user-header">
                    {% avatar user 160 class="img-circle" %}

                    <p>
                      {{ request.user.get_full_name|default:request.user.username }}
                      <small>{% trans "Member Since" %}, {{ request.user.date_joined|date:"M Y" }}</small>
                    </p>
                  </li>
                  <!-- Menu Body -->
                  <li class="user-body">
                    <div class="row">
                      {% if user.is_superuser %}
                      <div class="div col-xs-4 text-center"><a href="{% url "admin:index" %}">{% trans "Admin" %}</a></div>
                      <div class="div col-xs-4 text-center"><a href="/admin/auth/user/">{% trans "Users" %}</a></div>
                      <div class="div col-xs-4 text-center"><a href="/admin/helpline/">{% trans "Helpline" %}</a></div>

                      {% endif %}
                      <br/>
                    </div>
                    <!-- /.row -->
                  </li>
                  <!-- Menu Footer-->
                  <li class="user-footer">
                    <div class="pull-left">
                      <a href="{% url "helpline_user_profile" user %}" class="btn btn-default btn-flat">{% trans "Profile" %}</a>
                    </div>
                    <div class="pull-right">
                      <a href="{% url 'logout' %}" class="btn btn-default btn-flat">{% trans "Sign out" %}</a>
                    </div>
                  </li>
                </ul>
              </li>
              <!-- Control Sidebar Toggle Button -->
              <li>
                <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
              </li>
            </ul>
          </div>

        </nav>
      </header>
      <!-- Left side column. contains the logo and sidebar -->
      <aside class="main-sidebar">
        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">
          <!-- Sidebar user panel -->
          <div class="user-panel">
            <div class="pull-left image">
              {% avatar user 160 class="img-circle" %}
            </div>
            <div class="pull-left info">
              <p>{{ request.user.get_full_name|default:request.user.username }}</p>
              <a href="#" class="hide"><i id="agent_status" class="fa fa-circle text-warning" data-status="Idle"></i><span id="agent_status_value">{% trans "Idle" %}</span></a>
            </div>
          </div>
          <!-- search form -->
          <form action="{% url 'dashboardreports' 'search' %}" method="get" class="sidebar-form" data-pjax>
            <div class="input-group">
              <input id="navbar-search-input" type="text" name="q" class="form-control" placeholder="{% trans "Search" %}..." value="{{ query }}">
              <span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i></button>
              </span>
            </div>
          </form>
          <!-- /.search form -->
          <!-- sidebar menu: : style can be found in sidebar.less -->
          <ul class="sidebar-menu">
            <li class="header">{% trans "MAIN NAVIGATION" %}</li>
            <li class="active">
              <a href="/helpline/">
                <i class="fa fa-dashboard"></i> <span>{% trans "Dashboard" %}</span>
              </a>
            </li>
            <li class="treeview">
              <a href="#">
                <i class="fa fa-files-o"></i>
                <span>{% trans "Cases" %}</span>
                <span class="pull-right-container">
                  <i class="fa fa-angle-left pull-right"></i>
                </span>
              </a>
              <ul class="treeview-menu">
                <li>
                  <a href="{% url "case_form" "walkin" %}" role="button"><i class="fa fa-circle-o"></i> {% trans "New WalkIn" %}
                  </a>
                </li>
                <li><a href="{% url 'dashboardreports' 'all' %}"><i class="fa fa-circle-o"></i> {% trans "Today's Cases" %}
                    <span class="pull-right-container">
                      <span class="label label-success pull-right">{{ dashboard_stats.total_cases }}</span>
                    </span>
                  </a></li>
                  <li><a href="{% url 'dashboardreports' 'pendingcases' %}"><i class="fa fa-circle-o"></i> {% trans "Pending Cases" %}
                      <span class="pull-right-container">
                        <span class="label label-warning pull-right">{{ dashboard_stats.open_cases }}</span>
                      </span>
                    </a></li>
                    <li><a href="{% url 'dashboardreports' 'totalcases' %}"><i class="fa fa-circle-o"></i> {% trans "All Cases" %}
                        <span class="pull-right-container">
                          <span class="label label-info pull-right">{{ dashboard_stats.total_cases }}</span>
                        </span>
                      </a></li>
              </ul>
            </li>
            <li class="treeview">
              <a href="#">
                <i class="fa fa-files-o"></i>
                <span>{% trans "Calls" %}</span>
                <span class="pull-right-container">
                  <i class="fa fa-angle-left pull-right"></i>
                </span>
              </a>
              <ul class="treeview-menu">
                <li><a href="{% url 'dashboardreports' 'answeredcalls' %}"><i class="fa fa-circle-o"></i> {% trans "Answered Calls" %}
                    <span class="pull-right-container">
                      <span class="label label-success pull-right">{{ dashboard_stats.answered_calls }}</span>
                    </span>
                  </a>
                </li>
                <li><a href="{% url 'dashboardreports' 'voicemails' %}"><i class="fa fa-circle-o"></i> {% trans "Voice Mails" %}
                    <span class="pull-right-container">
                      <span class="label label-warning pull-right">{{ dashboard_stats.total_voicemail }}</span>
                    </span>
                  </a>
                </li>
              </ul>
            </li>

            {% if user.is_staff %}
            <li class="treeview" >
              <a href="#">
                <i class="fa fa-phone"></i>
                <span>{% trans "Monitor" %}</span>
                <span class="pull-right-container">
                  <i class="fa fa-angle-left pull-right"></i>
                </span>
              </a>
              <ul class="treeview-menu" id="monitor_queue_list">
                {% for queue_name, queue in queues.items  %}
                <li>
                  <a href="{% url 'queue' queue_name  %}">
                    <i class="fa fa-circle-o"></i>{{ queue_name }}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right">{{ queue.members | length }}</span>
                    </span>
                  </a>
                </li>
                {% endfor %}
              </ul>
            </li>
            {% endif %}

            <li class="treeview {% block treeview_reports %}{% endblock treeview_reports %}">
              <a href="#">
                <i class="fa fa-pie-chart"></i> <span>{% trans "Reports" %}</span>
                <span class="pull-right-container">
                  <i class="fa fa-angle-left pull-right"></i>
                </span>
              </a>
              <ul class="treeview-menu">
                <li><a href="{% url 'cdr_report' %}"><i class="fa fa-circle-o"></i>{% trans "CDR Report" %}
                  </a></li>
                <li><a href="{% url 'dashboardreports' 'totalcalls' %}"><i class="fa fa-circle-o"></i>{% trans "Total Calls" %}
                  </a></li>
                  <li><a href="{% url 'dashboardreports' 'answeredcalls' %}"><i class="fa fa-circle-o"></i>{% trans "Answered Calls" %}
                    </a></li>
                    <li><a href="{% url 'dashboardreports' 'abandonedcalls' %}"><i class="fa fa-circle-o"></i>{% trans "Abandoned Calls" %}
                      </a></li>
                      <li><a href="{% url 'dashboardreports' 'voicemail' %}"><i class="fa fa-circle-o"></i>{% trans "Voice Mail" %}
                        </a></li>
                        <li><a href="{% url 'adminreports' 'callsummaryreport' %}"><i class="fa fa-circle-o"></i>{% trans "Call Summary Report" %}
                          </a></li>
                          <li><a href="{% url 'report_charts' 'callsummary' 'call' %}"><i class="fa fa-circle-o"></i>{% trans "Charts Inbound" %}
                            </a></li>
                              <li><a href="{% url 'adminreports' 'totalcalls' 'walkin' %}"><i class="fa fa-circle-o"></i>{% trans "Walkin Report" %}
                                </a></li>
                                {% if request.user.is_staff %}
                                <li>
                                    <a href="{% url 'adminreports' 'agentsessionreport' %}"><i class="fa fa-circle-o"></i>{% trans "Agent Session" %}
                                    </a>
                                </li>
                                {% endif %}
              </ul>
            </li>
            {% if user.is_staff %}
            <li>
              <a href="#">
                <i class="fa fa-tv"></i> <span>{% trans "Dashboards" %}</span>
                <span class="pull-right-container">
                  <i class="fa fa-angle-left pull-right"></i>
                </span>
              </a>
			  <ul class="treeview-menu" id="wallboard_queue_list">
				  <li><a href="#" onclick="window.open('{% url 'wall' %}');"><i class="fa fa-tv"></i> Wall Board</a></li>
				  {% for queue_name, queue in queues.items  %}
				  <li>
					  <a href="{% url 'queue' queue_name  %}">
						  <i class="fa fa-circle-o"></i>{{ queue_name }}
						  <span class="pull-right-container">
							  <span class="label label-info pull-right">{{ queue.members | length }}</span>
						  </span>
					  </a>
				  </li>
				  {% endfor %}
			  </ul>
            </li>
            <li>
              <a href="{% url 'panel_home' %}">
                <i class="fa fa-bullseye"></i> <span>{% trans "Panel" %}</span>
              </a>
            </li>
            <li class="treeview">
              <a href="#">
                <i class="fa fa-bullhorn"></i>
                <span>{% trans "Call Center" %}</span>
                <span class="pull-right-container">
                  <i class="fa fa-angle-left pull-right"></i>
                </span>
              </a>
              <ul class="treeview-menu">
                <li>
                  <a href="{% url 'campaigns' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Campaigns" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'agent_console' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Agent Console" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'campaigns' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Calls" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
              </ul>
            </li>
            {% endif %}
            {% if request.user.CollectionUser %}
            <li class="treeview" >
              <a href="#">
                <i class="fa fa-money"></i>
                <span>{% trans "Collection CRM" %}</span>
                <span class="pull-right-container">
                  <i class="fa fa-angle-left pull-right"></i>
                </span>
              </a>
              <ul class="treeview-menu">
                <li>
                  <a href="{% url 'collection_crm:leads' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Leads" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:report' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Main Reports" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:loadcsv' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Upload Leads" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:users' %}">
                    <i class="fa fa-circle-o"></i>{% trans "User Manager" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:not_contacted' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Not Contacted" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:call_status_report' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Call Stauts Report" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:attempts' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Attempts Report" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:collection_summary' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Collection Summary" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:delinquency_report' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Collection Report" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:agent_productivity_report' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Collection Report" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:ptp_report' %}">
                    <i class="fa fa-circle-o"></i>{% trans "PTP Report" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:allocation_summary' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Allocation" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:audit_view' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Audit Logs" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:batch_history_download_loadcsv' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Batch Download" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'collection_crm:batch_edit_loadcsv' %}">
                    <i class="fa fa-circle-o"></i>{% trans "Batch Edit" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
              </ul>
            </li>
            {% endif %}
            <li class="treeview">
              <a href="#">
                <i class="fa fa-users"></i>
                <span>{% trans "Team" %}</span>
                <span class="pull-right-container">
                  <i class="fa fa-angle-left pull-right"></i>
                </span>
              </a>
              <ul class="treeview-menu">
                <li>
                    <a href="{% url 'my_invitations' %}">
                      <i class="fa fa-circle-o"></i>{% trans "Invitations" %}
                    <span class="pull-right-container">
                      <span class="label label-info pull-right"></span>
                    </span>
                  </a>
                </li>
              </ul>
            </li>

            <li>
              <a href="/helpline/agent_console/">
                <i class="fa fa-ticket"></i> <span>{% trans "Agent Console" %}</span>
                <span class="pull-right-container hide" id="helpdesk_ticket_counter">
                  <span class="label label-info pull-right" id="helpdesk_ticket_count"></span>
                </span>
              </a>
            </li>
	    <!--
            <li>
              <a href="#" onclick="window.open('https://sms.callcenter.africa');">
                <i class="fa fa-comment"></i> <span>{% trans "SMS" %}</span>
                <span class="pull-right-container">
                  <span class="label label-info pull-right"></span>
                </span>
              </a>
            </li>
	    -->
            <li>
              <a href="#">
                <i class="fa fa-money"></i> <span>{% trans "Billing" %}</span>
                <span class="pull-right-container">
                  <span class="label label-info pull-right"></span>
                </span>
              </a>
            </li>

          </ul>
        </section>
        <!-- /.sidebar -->
      </aside>

      <div class="modal fade in" id="modal-dtmf" style="display: none;">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span></button>
              <h4 class="modal-title"><center>Audio Player</center></h4>
            </div>
            <div class="modal-body">
              <center>
                <button type="button" class="btn btn-round-xxl btn-dtmf">1</button><button type="button" class="btn btn-round-xxl btn-dtmf">2</button><button type="button" class="btn btn-round-xxl btn-dtmf">3</button><br><button type="button" class="btn btn-round-xxl btn-dtmf">4</button><button type="button" class="btn btn-round-xxl btn-dtmf">5</button><button type="button" class="btn btn-round-xxl btn-dtmf">6</button><br><button type="button" class="btn btn-round-xxl btn-dtmf">7</button><button type="button" class="btn btn-round-xxl btn-dtmf">8</button><button type="button" class="btn btn-round-xxl btn-dtmf">9</button><br><button type="button" class="btn btn-round-xxl btn-dtmf">*</button><button type="button" class="btn btn-round-xxl btn-dtmf">0</button><button type="button" class="btn btn-round-xxl btn-dtmf">#</button>
              </center>
            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>

      <div class="modal fade in" id="modal-audio-player" style="display: none;">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span></button>
              <h4 class="modal-title"><center>Audio Player</center></h4>
              <div class="col-sm-2">
                <button class="btn btn-success btn-block" id="playPause">
                  <span id="play">
                    <i class="glyphicon glyphicon-play"></i>
                    Play
                  </span>

                  <span id="pause" style="display: none">
                    <i class="glyphicon glyphicon-pause"></i>
                    Pause
                  </span>
                </button>
              </div>
            </div>
            <div class="modal-body">
              <center>
                <div id="waveform"></div>

              </center>

            </div>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>

      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
        <div id="ask-desktop-notification-alert" class="alert alert-info alert-dismissible hide">
          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
          Helpline needs your permission to <a class="request-desktop-notifications" href="#">enable desktop notifications.</a>
        </div>

        <!-- Main content -->

        {% block message %}
        {% if message or messages or message_list %}
        {% include "helpline/message.html" %}
        {% endif %}
        {% endblock %}

		{% if user_email_domain == "mogo.co.ke" %}
		{% get_social_accounts user as accounts %}
		{% if not accounts.microsoft %}
		<div class="alert alert-dismissable alert-warning fade in">
			<button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
			<h4><i class="icon fa fa-warning"></i>Connect your Mogo Africa Microsoft account</h4>
			<p>
			<a href="{% provider_login_url "microsoft" process="connect" %}">
				Click here to connect your Mogo Africa Microsoft Account
			</a>
			</p>
		</div>
		{% endif %}
		{% endif %}

        {% if user_email_domain == "4g-capital.com" %}
        {% get_social_accounts user as accounts %}
        {% if not accounts.google %}
        <div class="alert alert-dismissable alert-warning fade in">
          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
          <h4><i class="icon fa fa-warning"></i>Connect your 4G Capital Google account</h4>
          <p>
          <a href="{% provider_login_url "google" process="connect" %}">
            Click here to connect your 4G Capital Google account
          </a>
          </p>
        </div>
        {% endif %}
        {% endif %}
        <!-- Main row -->

        <section class="content">
          <div class="row">
            <div class="col-md-8" id="pjax-container">
              {% block content %}
              {% endblock content %}
              {% block body %}
              {% endblock body %}
            </div>
            <!-- Phone -->
            <div class="col-md-4" id="web_phone">

            </div>
          </div>
        </section>
        <!-- /.content-wrapper -->

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
          <!-- Create the tabs -->
          <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
            <li>
              <a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a>
            </li>
            <li>
              <a href="#control-sidebar-phone-tab" data-toggle="tab"><i class="fa fa-phone"></i></a>
            </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <!-- Home tab content -->
            <div class="tab-pane" id="control-sidebar-home-tab">
              <h3 class="control-sidebar-heading">Recent Activity</h3>
              <ul class="control-sidebar-menu">
              </ul>
              <!-- /.control-sidebar-menu -->
            </div>
            <!-- /.tab-pane -->
          </div>
        </aside>
        <!-- /.control-sidebar -->
        <!-- Add the sidebar's background. This div must be placed
          immediately after the control sidebar -->
          <div class="control-sidebar-bg"></div>

      </div>
      <!-- ./wrapper -->

      <footer class="main-footer">
        <div class="pull-right hidden-xs">
          <b>{% trans "Version" %}</b> 1.0.0
        </div>
        {% now "Y" as current_year %}
        <strong>{% blocktrans %}Copyright{% endblocktrans %} &copy; {{ current_year }} <a href="{% url "index" %}" target="_blank">Elloe AI</a></strong>. {% blocktrans %}All rights reserved.{% endblocktrans %}
      </footer>
      <!-- Bootstrap 3.3.6 -->
      <script src="{% static "bootstrap/dist/js/bootstrap.min.js" %}"></script>
      <!-- FastClick -->
      <script src="{% static "AdminLTE/plugins/fastclick/fastclick.js" %}"></script>
      <!-- AdminLTE App -->
      <script src="{% static "AdminLTE/dist/js/app.min.js" %}"></script>
      <!-- Sparkline -->
      <!-- jvectormap -->
      <script src="{% static "AdminLTE/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js" %}"></script>
      <script src="{% static "AdminLTE/plugins/jvectormap/jquery-jvectormap-world-mill-en.js" %}"></script>
      <!-- SlimScroll 1.3.0 -->
      <script src="{% static "AdminLTE/plugins/slimScroll/jquery.slimscroll.min.js" %}"></script>
      <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
      <!-- AdminLTE for demo purposes -->
      <script src="{% static "AdminLTE/dist/js/demo.js" %}"></script>

      <script src="{% static "helpline/js/utils.js" %}"></script>
      <script src="{% static "easytimer.js/dist/easytimer.js" %}"></script>

      <script type="text/javascript" src="{% static "jquery-pjax/jquery.pjax.js" %}"></script>

      <!-- moment.js -->
      <script src="{% static 'moment/min/moment.min.js' %}" type="text/javascript"></script>

      <!-- Daterange picker -->
      <link href="{% static "bootstrap-daterangepicker/daterangepicker.css" %}" rel="stylesheet" type="text/css" />
      <!-- date-range-picker -->
      <script src="{% static 'bootstrap-daterangepicker/daterangepicker.js' %}" type="text/javascript"></script>

  <script type="text/javascript">
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          // Does this cookie string begin with the name we want?
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
const csrftoken = getCookie('csrftoken');
  </script>

      <script type="text/javascript">
        function pause_agent(queue=null) {
          console.log("Pausing agent!");
          request_url = '{% url "ajax_get_breaks" %}';
          $.ajax({
            url: request_url,
            type: "GET",
            success: function(data){
              bootbox.prompt({
                title: "{% trans 'Select a pause reason' %}",
                inputType: 'select',
                inputOptions: data,
                callback: function(result) {
                  send_pause_request(result, queue);
                }

              });
            }
          })
        }

function send_invite() {
  bootbox.prompt({
    title: "{% trans 'Enter the email address or list of email addresses' %}",
    inputType: 'textarea',
    callback: function (result) {
      send_invite_request(result);
    }
  });
};


function send_invite_request(result) {
  console.log("Send invite!");
  $.ajax({
    url : "{% url 'send_invite' %}",
    headers: {'X-CSRFToken': csrftoken},
    type : "POST",
    data : { email : result },

    // handle a successful response
    success : function(json) {
      console.log(json);
      toastr.success(json.message.Message, json.message.Response);
    },

    // handle a non-successful response
    error : function(xhr,errmsg,err) {
      toastr.error("{% trans 'Sending Invite Failed.' %}");
      console.log(xhr.status + ": " + xhr.responseText);
    }
  });

};


function send_pause_request(reason=null, queue=null) {
  $.ajax({
    url : "{% url 'queue_pause' %}",
    headers: {'X-CSRFToken': csrftoken},
    type : "POST",
    data : { reason : reason, queue: queue },

    // handle a successful response
    success : function(json) {
      console.log(json);
      if(json.message.Response == "failed"){
        // show error message and remove py-Asterisk prefix from message
        toastr.warning(json.message.Message.replace("py-Asterisk",""), json.message.Response);
      }else{
        toastr.success(json.message.Message, json.message.Response);
      }
    },

    // handle a non-successful response
    error : function(xhr,errmsg,err) {
      toastr.error("{% trans 'Queue Pause Failed.' %}");
      console.log(xhr.status + ": " + xhr.responseText);
    }
  });

};

      </script>

      <script type="text/javascript">
        function unpause_agent(queue=null) {
          console.log("Unpausing agent!");
          $.ajax({
            url : "{% url 'queue_unpause' %}",
            headers: {'X-CSRFToken': csrftoken},
            type : "POST",
            data : { queue: queue, extension: $('#you').text() },

            // handle a sucessful response
            success : function(json){
              toastr.success(json.message.Message, json.message.Response);
            },

            //handle a non-sccessful response
            error : function(xhr,errmsg,err) {
              toastr.error("Could not unpause.");
              console.log(xhr.status + ": " + xhr.resposeText);
            }
          });
        };

      </script>

      <script type="text/javascript">
        // Submit post on submit
        $('#queue-log-form').on('submit', function(event){
          event.preventDefault();
          console.log("Queue login form submitted!");
          queue_join();
        });

function queue_join(queue = null) {
  console.log("Joining Queue");

  if (queue){
    $('#id_queue').val(queue);
  }

  var queue_form = $('#queue-log-form');

  $.ajax({
    url : "{% url 'queue_log' %}",
    headers: {'X-CSRFToken': csrftoken},
    type : "POST",
    data : queue_form.serialize(),

    // handle a sucessful response
    success : function(json){
      toastr.success(json.message.Message, json.message.Response);
      console.log(json);
    },

    //handle a non-sccessful response
    error : function(xhr,errmsg,err) {
      toastr.error("Could not join queue.");
      console.log(xhr.status + ": " + xhr.resposeText);
    }
  });
};
      </script>


{% include 'helpline/panel_global_js.html' %}
      <script type="application/javascript">
        $(document).pjax("a", "#pjax-container", {timeout: 7200000});
$(document).on("pjax:send", function(e) {
});

$(document).on("pjax:start", function(e) {
});

$(document).on("pjax:complete", function() {
  window.bindSelectables('body');
  var campaignsTableElementExists = document.getElementById("campaigns_table");
  var campaignDataTableElementExists = document.getElementById("campaign_data_table");

  if (campaignsTableElementExists) {
    var table = $('#campaigns_table').DataTable({
      order: [[1, 'desc']],
      dom: 'Blrtip',
    });
    function filterGlobal() {
      $('#campaigns_table')
        .DataTable()
        .search($('#campaign_table_search').val())
        .draw();
    }
    $('#campaign_table_search').on('keyup click', function () {
      filterGlobal();
    });
  }

  if(campaignDataTableElementExists) {
    var table = $('#campaign_data_table').DataTable({
      retrieve: true,
      dom: 'Blrtip',
    });
    function filterDataGlobal() {
      $('#campaign_data_table')
        .DataTable()
        .search($('#campaign_data_table_search').val())
        .draw();
    }
    $('#campaign_data_table_search').on('keyup click', function () {
      filterDataGlobal();
    });
  }

  var cdrTableElementExists = document.getElementById("cdr_table");
  var cdrDataTableElementExists = document.getElementById("cdr_data_table");

  if (cdrTableElementExists) {
    var table = $('#cdr_table').DataTable({
      dom: 'Blrtip',
    });
    function filterCdrGlobal() {
      $('#cdr_table')
        .DataTable()
        .search($('#cdr_table_search').val())
        .draw();
    }
    $('#cdr_table_search').on('keyup click', function () {
      filterCdrGlobal();
    });
  }

  if(cdrDataTableElementExists) {
    var table = $('#campaign_data_table').DataTable({
      retrieve: true,
      dom: 'Blrtip',
    });
    function filterDataGlobal() {
      $('#campaign_data_table')
        .DataTable()
        .search($('#campaign_data_table_search').val())
        .draw();
    }
    $('#campaign_data_table_search').on('keyup click', function () {
      filterDataGlobal();
    });
  }

});


$(document).on('submit', 'form[data-pjax]', function(event) {
  $.pjax.submit(event, '#pjax-container')
})

{% if user.is_staff %}
$(document).ready(function () {
  setInterval(function () {
     getDataQueues();
  }, REQUEST_INTERVAL);
});
{% endif %}

// Parse data and put values on view
// Shit!, this will be improved
// If you can do it send a Pull Request
function parseDataQueues(data) {
    if (data == null) {
        return 0;
    }
  var maps_agents = Array();
  var uniques_ids = Array();
  var answers = 0, unattended = 0, incoming = 0;
  var c_hold = 0, holdtime = 0, c_talk = 0, talktime = 0;
  var call_in_service_level = 0;
  var total_agents = 0, total_calls = 0;

  for (var q in data) {
    var queue = data[q];

    answers = answers + parseInt(queue.Completed);
    unattended = unattended + parseInt(queue.Abandoned);
    incoming = incoming + parseInt(queue.Calls);

    $("[id='data-"+ q + "'] #queue_completed").html(parseInt(queue.Completed));
    $("[id='data-"+ q + "'] #queue_abandoned").html(parseInt(queue.Abandoned));
    $("[id='data-"+ q + "'] #queue_incoming").html(parseInt(queue.Calls));
    $("#queue_"+ q + "_queue_users").html(len(queue.members));
    $(".header-"+ q + " #strategy").html(queue.Strategy);

    // Update monitor list on sideboard
    var monitor_queue_list_html = `
      <li>
      <a href="/helpline/queue/${queue.slug}/">
      <i class="fa fa-circle-o"></i>${queue.name}
      <span class="pull-right-container">
      <span class="label label-info pull-right">${len(queue.members)}</span>
      </span>
      </a>
      </li>
      `;
    // Update monitor wallboards list on sideboard
    var monitor_wallboard_list_html = `
      <li>
      <a href="/helpline/wallboard/${queue.slug}/">
      <i class="fa fa-circle-o"></i>${queue.name}
      <span class="pull-right-container">
      <span class="label label-info pull-right">${len(queue.members)}</span>
      </span>
      </a>
      </li>
      `;
    $("#monitor_queue_list").append(monitor_queue_list_html);
    $("#wallboard_queue_list").append(monitor_wallboard_list_html);

    if (SHOW_SERVICE_LEVEL === true) {
      $("[id='data-"+ q + "'] #queue_servicelevel").html(queue.ServicelevelPerf + '%');
      call_in_service_level +=  queue.Completed * parseFloat(queue.ServicelevelPerf) / 100;
    }

    if (queue.Abandoned > 0) {
      $("[id='"+ q + "-percent_abandoned']")
        .html(parseInt(parseInt(queue.Abandoned)  * 100 / (parseInt(queue.Abandoned) + parseInt(queue.Completed) )));
    }

    if (parseInt(queue.TalkTime) > 0 ) {
      talktime = talktime + parseInt(queue.TalkTime);
      c_talk++;
    }

    if (parseInt(queue.Holdtime) > 0 ) {
      holdtime = holdtime + parseInt(queue.Holdtime);
      c_hold++;
    }

    // agents
    maps_agents[q] = Array();
    for (a in queue.members) {
      total_agents++;
      maps_agents[q].push(clean_div_name(a));
      agent = queue.members[a];
      agent_id_div = '[data-agent="{agent}"][data-queue="{queue}"]'.format({agent: clean_div_name(a), queue: q})

      str_time_ago = ''
      if (agent.LastCall > 0) {
        str_time_ago = agent.LastCallAgo;
      }
      if (a === 'SIP/' + localStorage.userName){
        $('#agent_status').data('status', agent.Status.toStrStatusAgent());
        $('#agent_status_value').html(agent.Status.toStrStatusAgent());
        addLabelDivStatusUser($('#agent_status'));
        $('#queue_status_' + q).html("");
        $('#queue_status_' + q).data('status', agent.Status.toStrStatusAgent());
        $('#queue_status_' + q).html(agent.Status.toStrStatusAgent());
        addLabelDivStatusQueue($('#queue_status_' + q));

      }
      $(agent_id_div + ' #last_call').html(str_time_ago)

      $(agent_id_div + ' #status .state').html(agent.Status.toStrStatusAgent())
      addLabelDivStatusAgent($(agent_id_div + ' #status .state'));
      if (agent.Paused == true) {
        // reason pause introduced in https://goo.gl/Njm6H5
        // if dont have feature in your Asterisk
        // check directory patches
        var reason = '';
        if (agent.PausedReason){
          reason = ": {reason}".format({'reason': agent.PausedReason});
        }
        var last_pause_time = '';
        if (parseInt(agent.LastPauseAgo.split(" ")[0]) > 0) {
          last_pause_time = " {last_pause} ago".format({'last_pause': agent.LastPauseAgo});
        }

        $(agent_id_div + ' #status .pause').remove();
        $(agent_id_div +' #status .state')
          .after(' <span class="label label-info label-mini pause">paused'+ reason + last_pause_time + '</span>');
      } else {
        $(agent_id_div + ' #status .pause').remove();
      }

      if ($(agent_id_div).length == 0) {
        var tr = '<tr data-queue="' + q + '" data-agent="' + clean_div_name(a) + '"><td>'
          + queue.name + '</td>'
          + '<td>' + agent.Name + '</td>'
          + '<td>' + agent.StateInterface + '</td>'
          + '<td id="status"> <span class="label label-info label-mini state">'
          + agent.Status.toStrStatusAgent()
          + '</span></td>'
          + '<td id="last_call"></td></tr>';

        if ($('#dashboard_agents tbody tr:last').length > 0) {
          $('#dashboard_agents tbody tr:last').after(tr);
        } else {
          $('#dashboard_agents tbody').append(tr);
        }
      }
    }

    //callers
    for (caller in queue.entries) {
      c = queue.entries[caller];
      total_calls++;

      if ($("[id='caller-"+ c.Uniqueid + "']").length == 0) {
        console.log('add:' + c.Uniqueid);
        var tr = '<tr id="caller-' + c.Uniqueid + '" data-uniqueid="' + c.Uniqueid + '"><td>'
          + c.CallerIDName + '</td>'
          + '<td>' + c.CallerIDNum + '</td>'
          + '<td id="position">'  + c.Position + '</td>'
          + '<td id="wait">' + c.WaitAgo + '</td></tr>'

        if ($('#callers tbody tr:last').length > 0){
          $('#callers tbody tr:last').after(tr);
        } else {
          $('#callers tbody').append(tr);
        }
      }

      $("[id='caller-"+ c.Uniqueid + "'] #wait").html(c.WaitAgo);
      $("[id='caller-"+ c.Uniqueid + "'] #position").html(c.Position);
      uniques_ids.push(c.Uniqueid);
    }
  }

  $.each($("[id^='caller-']"), function( index, value ) {
    uid = $(value).data('uniqueid');
    if (uniques_ids.indexOf(uid.toString()) == -1) {
      console.log('removed: ' + uid);
      $("[id='caller-"+ uid +"']").remove();
    }
  });
  $('#total_callers').html("{total}".format({total:  total_calls}));


  $.each($("[data-agent]"), function( index, value ) {
    queue = $(value).data('queue');
    agent = $(value).data('agent');
    if (maps_agents[queue].indexOf(agent.toString()) == -1) {
      console.log('removed: %s from %s', agent, queue);
      $(value).remove();
    }
  });
  $('#total_agent').html("{total}".format({total:  total_agents}));

  // General row

   $('#answered').html(answers);
   $('#abandoned').html(unattended);
  $('#incoming').html(incoming);
  if (c_hold > 0 ) {
     $('#av_wait').html(parseInt((holdtime / c_hold)).toString().toMMSS());
  }
  if (c_talk > 0){
     $('#av_time').html(parseInt((talktime / c_talk)).toString().toMMSS());
  }

}

function getDataQueues() {
  var result;
  var r = $.ajax({
    type: 'GET',
    url: '{% url "queues" %}'
  });
  r.done(function (response) {
    if (response) {
      result = response.data;
        if (result){
            $("#monitor_queue_list").empty();
            parseDataQueues(result);
        }
    }
  });
  r.fail(function (response) {
  });

  r.always(function () {
  });
}
    </script>

    <script type="text/javascript">
        function getLoginDuration() {
            var result;
            var r = $.ajax({
                type: 'GET',
                url: '{% url "leta" %}'
            });
            r.done(function (response) {
                if (response) {
                    result = response.data;
                    if (result){
                        $("#durations").empty();
                        $("#durations").html(`
                            <h4>
                            <i class="fa fa-clock-o"></i>
                            {% trans "Login Duration" %}
                            </h4>
                            <p style="display:inline-block;font-size:38px;font-family:"OpenSans-Light",sans-serif;height:63px;line-height:59px;position:relative;vertical-align:middle;z-index:5">` + result.login_duration.hours + ":" + result.login_duration.min + ":" + result.login_duration.seconds + `
                            </p>
                            `
                        );
                    }
                }
            });
            r.fail(function (response) {
            });

            r.always(function () {
            });
        }

    </script>

        <script type="text/javascript">
function getHomeDashboard(page=1) {
  var result;
  var r = $.ajax({
    type: 'GET',
    url: '{% url "home_dashboard" %}?page=' + page
  });
  r.done(function (response) {
    if (response) {
      result = response.data;
      dashboard_stats = response.dashboard_stats;
        if (result){
            $("#home_dashboard").empty();
            $("#home_dashboard").html(result);
            if(dashboard_stats){
                $("#dashboard_stats_att").html(
                    `
                      <i class="fa fa-bookmark"></i>
                      {% trans "Average Talk Time" %}:
                ` + dashboard_stats.att.hours + ":" + dashboard_stats.att.min + ":" + dashboard_stats.att.seconds

                );
                $("#dashboard_stats_awt").html(
                    `
                      <i class="fa fa-bookmark"></i>
                      {% trans "Average Hold Time" %}:
                ` + dashboard_stats.awt.hours + ":" + dashboard_stats.awt.min + ":" + dashboard_stats.awt.seconds

                );
            }
        }
    }
  });
  r.fail(function (response) {
  });

  r.always(function () {
  });
}
      </script>


      <script>
        String.prototype.toStrStatusAgent = function(args) {
          var value = this;
          if (C.status_agent.NOT_INUSE == value) {
            return "Online";
          } else if (C.status_agent.INCALL == value) {
            return "In call";
          } else if (parseInt(value).isUnavailableInAsterisk()) {
            return "Unavailable";
          } else if (C.status_agent.RINGING == value) {
            return "Ringing"
          } else if (C.status_agent.INUSE == value) {
            return "In use"
          } else if (C.status_agent.BUSY == value) {
            return "Busy"
          } else if (C.status_agent.ONHOLD == value) {
            return "On Hold"
          } else {
            return "Busy"
          }
        }

function addLabelDivStatusAgent(div) {
  var label;
  div.removeClass('label-warning label-info label-danger label-success');
  value = div.html();
  if (value == "Online") {
    label = 'success';
  } else if (value == "Unavailable") {
    label = 'danger';
    //Freeswitch status and states
  } else if (value == "Logged Out") {
    label = 'danger';
  } else if (value == "Available") {
    label = 'info';
  } else if (value == "Available (On Demand)") {
    label = 'info';
  } else if (value == "On Break") {
    label = 'warning';
  } else if (value == "Idle") {
    label = 'info';
  } else if (value == "Waiting") {
    label = 'info';
  } else if (value == "Receiving") {
    label = 'warning';
  } else if (value == "In a queue call") {
    label = 'warning';
  } else {
    label = 'warning';
  }
  div.addClass('label-'+label);
}

function addLabelDivStatusUser(div) {
  var label;
  div.removeClass('text-warning text-info text-danger text-success');
  value = div.data('status');
  if (value == "Online") {
    label = 'success';
  } else if (value == "Unavailable") {
    label = 'danger';
    //Freeswitch status and states
  } else if (value == "Logged Out") {
    label = 'danger';
  } else if (value == "Available") {
    label = 'success';
  } else if (value == "Available (On Demand)") {
    label = 'success';
  } else if (value == "On Break") {
    label = 'warning';
  } else if (value == "Idle") {
    label = 'success';
  } else if (value == "Waiting") {
    label = 'success';
  } else if (value == "Receiving") {
    label = 'warning';
  } else if (value == "In a queue call") {
    label = 'warning';
  } else {
    label = 'warning';
  }
  div.addClass('text-'+label);
}

function addLabelDivStatusQueue(div) {
  var label;
  div.removeClass('text-warning text-info text-danger text-success');
  value = div.data('status');
  if (value == "Online") {
    label = 'success';
  } else if (value == "Unavailable") {
    label = 'danger';
    //Freeswitch status and states
  } else if (value == "Logged Out") {
    label = 'danger';
  } else if (value == "Available") {
    label = 'success';
  } else if (value == "Available (On Demand)") {
    label = 'success';
  } else if (value == "On Break") {
    label = 'warning';
  } else if (value == "Idle") {
    label = 'success';
  } else if (value == "Waiting") {
    label = 'success';
  } else if (value == "Receiving") {
    label = 'warning';
  } else if (value == "In a queue call") {
    label = 'warning';
  } else {
    label = 'warning';
  }
  div.addClass('text-'+label);
}

      </script>

      <script type="text/javascript">

        // Get current login duration.
        // Interval set to every one second.
        {# Only check for calls if current user is available #}
function check_call(){

    dev_mode = 0;
    $.get("{% url "check_call" %}", function(data){
      if(data.my_case){
        var external_url = data.external_url_template;
        if(data.external_url_status)
        {
          external_url = external_url.replace(
            "{__AGENT_EMAIL__}", data.agent_email
          );
          external_url = external_url.replace(
            "{__PHONE__}", data.telephone
          );
          external_url = external_url.replace(
            "{__CAMPAIGN_ID__}", data.service
          );
          external_url = external_url.replace(
            "{__CALL_TYPE__}", data.calltype
          );
          if (data.external_url_opentype == "window") {
            window.open(external_url, "_blank");
          } else if (data.external_url_opentype =="iframe") {
            $('#pjax-container').html('<iframe src="'+external_url+'?d[case_id]='+data.my_case+ '" frameborder="0" id="external_url_iframe" width="100%" height="1000px"></iframe>');
          }
        } else {
        $.pjax({url : "{% url "case_form" "call"  %}?case="+data.my_case+"&uniqueid="+data.uniqueid, container: '#pjax-container', timeout: 720000});
        }
        } else if (!(data.hasOwnProperty("my_case"))) {
          console.log(data);
          //alert('{% trans "You have been logged out." %}');
          //window.location.href = "/";
        }
      });
  }

      </script>

      <script type="text/javascript">
        function getFinalRedirect(url, callback) {
          var xhr = new XMLHttpRequest();
          xhr.open('HEAD', url, true);

          xhr.onreadystatechange = function() {
            if (xhr.readyState == 4) {
              callback(xhr.responseURL);
            }
          };

          xhr.send();
        }


function audioPlayerLoad(uniqueid){

  wavesurfer.on('ready', function () {
    wavesurfer.play();
  });
  // Get a reference to the Bootstrap modal form
  var modal = $('#modal-audio-player');

  // Stop the audio playback when the modal form is closed
  modal.on('hidden.bs.modal', function () {
    wavesurfer.stop();
  });

  getFinalRedirect('{% url "get_recording" %}?uniqueid=' + uniqueid, function(finalUrl) {
    console.log(finalUrl);
    // Load the audio file
    wavesurfer.load(finalUrl);
  });

}
          
      </script>


      <script type="text/javascript">
        // Notification request

        if (Notification.permission === "granted") {
          console.log("we have notification permission");
        } else if (Notification.permission === "denied") {
          console.log("we do NOT have notification permission" + Notification.permission);
        } else if (Notification.permission === "default") {
          $('#ask-desktop-notification-alert').removeClass('hide');
        }

// Configure click handlers.
$(".request-desktop-notifications").on("click", function (e) {
  e.preventDefault();
  $(this).closest(".alert").hide();
  Notification.requestPermission(function (permission) {
    if (permission === "granted") {
      console.log("Notifications Enabled");
    }
  });
});

// Get the Web Phone and render to web_phone div
$(document).ready(function(){
  $.get("{% url "web_phone" %}",function(data){
    if(data.phone_html){
      $('#web_phone').html(data.phone_html);
    } else if (!(data.hasOwnProperty("phone_html"))) {
      console.log('{% trans "Phone not found" %}');
    }
  });
});
      </script>

      {% block javascript %}

      <!-- Le javascript -->
      <script type="text/javascript" src="{% url "javascript-catalog" %}"></script>
      <script src="{{STATIC_URL}}jquery-migrate/jquery-migrate.min.js"></script>

      <script type="text/javascript" src="{% static "webrtc-adapter/release/adapter.js" %}"></script>
      <script type="text/javascript" src="{% static "blockUI/jquery.blockUI.js" %}" ></script>
      <script type="text/javascript" src="{% static "bootbox.js/dist/bootbox.min.js" %}"></script>
      <script type="text/javascript" src="{% static "spin.js/spin.min.js" %}"></script>
      <script type="text/javascript" src="{% static "AdminLTE/plugins/datatables/jquery.dataTables.min.js" %}"></script>
      <script type="text/javascript" src="{% static "blueimp-md5/js/md5.min.js" %}"></script>
      <script type="text/javascript" src="{% static "toastr/toastr.min.js" %}"></script>
      <script type="text/javascript" src="{% static "helpline/js/janus.js" %}"></script>
      <script type="text/javascript" src="{% static "js/jquery.canvasjs.min.js" %}"></script>

      {% endblock %}

      {% block script_end %}
      {% endblock script_end %}
      {% block css %}{% endblock css %}
      {% block scripts %}{% endblock scripts %}

      {% block additional-javascript %}{% endblock %}
      <script src="{% static "helpline/js/custom.js" %}" type="text/javascript"></script>
      {%  include 'tellme/js_inc.html' %}
    </div>
  </body>
</html>
